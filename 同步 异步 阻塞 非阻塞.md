# 同步和异步

**同步：**

发出一个功能调用时，在没有得到结果之前，该调用就不返回或继续执行后续操作

简单来说，同步就是必须一件一件事做，等前一件做完了才能做下一件事

**异步：**

当一个异步过程调用发出后，调用者在没有得到结果之前，就可以继续执行后续操作。当这个调用完成后，**一般通过状态、通知和回调来通知调用者**。对于异步调用，调用的返回并不受调用者控制。

对于通知调用者的三种方式，具体如下：

+ 状态：即监听被调用者的状态（轮询），调用者需要每隔一定时间检查一次，效率会很低。
+ 通知：当被调用者执行完成后，发出通知告知调用者，无需消耗太多性能。
+ 回调：与通知类似，当被调用者执行完成后，会调用调用者提供的回调函数。

## 2. 阻塞和非阻塞

阻塞和非阻塞这两个概念与程序（线程）等待消息通知(无所谓同步或者异步)时的状态有关。也就是说阻塞与非阻塞主要是程序（线程）等待消息通知时的状态角度来说的。

阻塞和非阻塞关注的是**程序在等待调用结果（消息，返回值）时的状态.**

阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回。

非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程。

# 异步和多线程区别

## 1 异步和多线程有什么区别？

其实，异步是目的，而多线程是实现这个目的的方法。异步是说，A发起一个操作后（一般都是比较耗时的操作，如果不耗时的操作就没有必要异步了），可以继续自顾自的处理它自己的事儿，不用干等着这个耗时操作返回。

## 2  多线程和异步操作的异同

多线程和异步操作两者都可以达到避免调用线程阻塞的目的，从而提高软件的可响应性。甚至有些时候我们就认为多线程和异步操作是等同的概念。但是，多线程和异步操作还是有一些区别的。而这些区别造成了使用多线程和异步操作的时机的区别。

#  阻塞非阻塞与同步异步的区别

**同步/异步关注的是消息通知的机制**

**阻塞/非阻塞关注的是程序（线程）等待消息通知时的状态。**



以小明下载文件打个比方：



+ **同步阻塞**：小明一直盯着下载进度条，到 100% 的时候就完成。

  同步体现在：等待下载完成通知；

  阻塞体现在：等待下载完成通知过程中，不能做其他任务处理；

 

+ **同步非阻塞**：小明提交下载任务后就去干别的，每过一段时间就去瞄一眼进度条，看到 100% 就完成。

  同步体现在：等待下载完成通知，但是要在；

  非阻塞体现在：等待下载完成通知过程中，去干别的任务了，只是时不时会瞄一眼进度条；【小明必须要在两个任务间切换，关注下载进度】

 

+ **异步阻塞**：小明换了个有下载完成通知功能的软件，下载完成就“叮”一声。不过小明仍然一直等待“叮”的声音（看起来很傻，不是吗）。

  异步体现在：下载完成“叮”一声通知；

  阻塞体现在：等待下载完成“叮”一声通知过程中，不能做其他任务处理；

  

+ **异步非阻塞**：仍然是那个会“叮”一声的下载软件，小明提交下载任务后就去干别的，听到“叮”的一声就知道完成了。

  异步体现在：下载完成“叮”一声通知；

  非阻塞体现在：等待下载完成“叮”一声通知过程中，去干别的任务了，只需要接收“叮”声通知即可；【软件处理下载任务，小明处理其他任务，不需关注进度，只需接收软件“叮”声通知，即可】

 

也就是说，同步/异步是“下载完成消息”通知的方式（机制），而阻塞/非阻塞则是在等待“下载完成消息”通知过程中的状态（能不能干其他任务），在不同的场景下，同步/异步、阻塞/非阻塞的四种组合都有应用。

 

所以，综上所述，同步和异步仅仅是关注的消息如何通知的机制，而阻塞与非阻塞关注的是等待消息通知时的状态。也就是说，同步的情况下，是由处理消息者自己去等待消息是否被触发，而异步的情况下是由触发机制来通知处理消息者，所以在异步机制中，处理消息者和触发机制之间就需要一个连接的桥梁：

在小明的例子中，这个桥梁就是软件“叮”的声音。

# 效率对比及在程序中的实现

1 同步阻塞形式

效率是最低的，

实际程序中：就是未对fd 设置O_NONBLOCK标志位的read/write 操作；

 2 异步阻塞形式

比如select 函数，假如传入的最后一个timeout参数为NULL，那么如果所关注的事件没有一个被触发，程序就会一直阻塞在这个select 调用处。

3 同步非阻塞形式

是效率低下的

想象一下你一边干别的事情一边还需要抬头看下载完成没有，如果把干别的事情和观察下载完成情况的位置看成是程序的两个操作的话，这个程序需要在这两种不同的行为之间来回的切换，效率可想而知是低下的。

很多人会写阻塞的read/write 操作，但是别忘了可以对fd设置O_NONBLOCK 标志位，这样就可以将同步操作变成非阻塞的了。

4 异步非阻塞形式

效率更高

因为等待下载完成是你(等待者)的事情，而通知你则是电脑(消息触发机制)的事情，程序没有在两种不同的操作中来回切换。